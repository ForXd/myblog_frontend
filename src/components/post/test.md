### Web应用及工作流程

#### Web应用本质

- 浏览器发送HTTP请求到HTTP服务器
- HTTP服务器收到请求，生成HTML文档
- HTTP服务器把HTML文档(包含CSS，JS)作为HTTP响应的body发送给浏览器
- 浏览器收到HTTP响应，从body中取出HTML文档并显示

#### 后端框架

- 最简单的Web应用就是把HTML文件保存好，用现有的HTTP服务器接收用户请求，并读取HTML文件返回响应。Apache，Nginx等静态服务器就可以实现。
- 对于复杂的Web应用来说，需要大量的HTML文件，并且内容也是不固定的，会根据用户的行为生成不同的页面，因此，我们需要使用代码来生成HTML页面并返回。对于python来说，有一个统一的接口标准WSGI(Web Server Gateway Interface)，这个接口的定义是要求Web开发者实现一个函数，就可以响应HTTP请求。
- 这个函数有两个参数，一个是包含所有HTTP请求信息的dict对象，一个发送HTTP响应的函数。函数的返回值就是HTTP响应的body。
- 有了WSGI接口之后，就不需要自己解析HTTP请求，并且生成HTTP响应。
- 对于实现了WSGI接口的函数，可以通过WSGI服务器(gunicorn，uWsgi等)来调用，WSGI服务器会给函数传入接口定义的参数，并将函数的返回值发送给客户端。
- 但是对于复杂的Web应用，光靠一个实现了WSGI接口的函数来处理显得过于臃肿而不优雅，因此，在WSGI接口之上抽象出了Web框架，进一步简化了Web的开发。
- Web框架做的事情就是将臃肿的实现了WSGI接口的函数进行拆分，使得程序员在编写Web应用时可以专注于使用不同的函数来处理不同的URL，至于组合的问题就交给了Web框架，当然，Web框架还实现了许多功能，例如对数据库的访问，认证系统等。

#### 前端框架

- 我们看到的动态的，丰富多彩的HTML页面，虽然需要依靠不断的改变HTML的内容来实现，但是大多数情况下实际上每次改变的只是页面的一小部分，因此，我们并不需要重新请求整个页面来重新渲染，只需要请求一小部分的资源就可以完成页面的重新渲染
- AJAX(Asynchronous JavaScript and XML)，Web的运作原理是一次HTTP请求对应一个页面(这个HTTP请求是浏览器发出的)，如果想让用户留在当前页面中，并且同时发出新的HTTP请求，就需要使用Javascript来发送这个HTTP请求，**使用Javascript来发送HTTP请求就叫做AJAX**，接收到数据后，再使用Javascript更新页面，这样，用户就依然停留在当前页面，但是数据却可以不断更新。
- 前端框架就是由动态的实现单页式应用抽象而来的(单页应用不代表只有一个路由，前端框架也实现了路由功能来方便的组织HTML文档)
- 总之，前端框架的作用就是生成HTML文档(包含html，css，javascript)

#### Web应用的部署

- ![](D:\web-basic\deployment\web运行示意图.jpg)

- 从上图可以看到，浏览器向Nginx服务器请求的内容有两种，一种是动态的内容，也就是我们使用代码编写，动态生成的内容，这一部分请求Nginx会转发给WSGI服务器，另一种是静态的内容，这部分请求Nginx会直接返回静态的文件。（动态的请求大多数使用AJAX）。
- 为什么使用Nginx做进一步的转发
  - WSGI服务器也可以做静态文件的托管，但是WSGI服务器应该专注于动态内容的生成，因此，至少可以使用Nginx来做静态文件的托管。
  - Gunicorn服务器的处理模型是简单的，如果用户直接访问Gunicorn服务器，那么我们就需要担心那些速度很慢的用户，如果能够避免用户与Gunicorn服务器的直接接触，我们就不需要担心这个问题。
  - 当WSGI服务器与Nginx服务器都有多个时，需要Nginx来做反向代理。

